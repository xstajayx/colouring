<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Kids Coloring Book</title>

  <style>
    :root {
      color-scheme: light;
      --bg: #f4f3ff;
      --card: #ffffff;
      --ink: #1f1f2b;
      --muted: #6b6b7d;
      --accent: #7b5cff;
      --accent-soft: #efeaff;
      --outline: #e1def2;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
      margin: 0;
      color: var(--ink);
    }

    .app {
      width: min(1100px, 100%);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .hero {
      background: linear-gradient(135deg, #ffffff 0%, #f1ecff 100%);
      border-radius: 22px;
      padding: 22px 26px;
      box-shadow: 0 18px 40px rgba(55, 32, 120, 0.08);
      display: flex;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .hero h1 {
      font-size: 28px;
      margin: 0 0 6px;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
    }

    .hero .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent-soft);
      color: var(--accent);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .panel {
      background: var(--card);
      border-radius: 20px;
      padding: 16px 18px;
      border: 1px solid var(--outline);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .workspace {
      display: grid;
      grid-template-columns: minmax(220px, 260px) minmax(0, 1fr) minmax(220px, 260px);
      grid-template-areas:
        "pages pages pages"
        "tools canvas colors";
      gap: 18px;
      align-items: start;
    }

    .panel-pages {
      grid-area: pages;
    }

    .panel-tools {
      grid-area: tools;
    }

    .panel-colors {
      grid-area: colors;
    }

    .canvas-area {
      grid-area: canvas;
      display: flex;
      justify-content: center;
    }

    .section-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .section-title h2 {
      font-size: 18px;
      margin: 0;
    }

    .section-title span {
      color: var(--muted);
      font-size: 13px;
    }

    #toolbar, #toolbar2, #pages, #categories {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    #toolbar,
    #toolbar2 {
      align-items: center;
    }

    #categories {
      justify-content: flex-start;
    }

    .color-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid #ddd;
      cursor: pointer;
      box-sizing: border-box;
    }

    .color-btn.active {
      border: 3px solid #555;
    }

    .tool-btn, .page-btn, .size-btn, .brush-btn, .sticker-btn, .category-btn, .shape-btn {
      border: none;
      padding: 6px 12px;
      border-radius: 12px;
      cursor: pointer;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .tool-btn:hover,
    .page-btn:hover,
    .size-btn:hover,
    .brush-btn:hover,
    .sticker-btn:hover,
    .category-btn:hover,
    .shape-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
    }

    .size-btn, .brush-btn {
      font-size: 12px;
    }

    .size-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      padding: 0;
      justify-content: center;
    }

    .tool-btn.active,
    .page-btn.active,
    .size-btn.active,
    .brush-btn.active,
    .sticker-btn.active,
    .category-btn.active,
    .shape-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    #clear {
      background: #ff7676;
      color: white;
      font-weight: bold;
    }

    #save {
      background: #7ccf7c;
      color: white;
      font-weight: bold;
    }

    .page-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 8px;
      border-radius: 16px;
      background: #f8f6ff;
      border: 1px dashed var(--outline);
    }

    #canvas-wrapper {
      display: flex;
      justify-content: center;
      width: 100%;
    }

    #canvas-stack {
      position: relative;
      border: 5px solid #ddd;
      border-radius: 16px;
      overflow: hidden;
      background: white;
      touch-action: none;
      max-width: 100%;
      width: min(900px, 100%);
      aspect-ratio: 700 / 450;
      box-shadow: 0 18px 40px rgba(35, 24, 90, 0.12);
    }

    #outlineCanvas,
    #drawCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      max-width: 100%;
    }

    /* Make canvas responsive */
    @media (max-width: 750px) {
      #outlineCanvas,
      #drawCanvas {
        width: 100%;
        height: auto;
      }

      #canvas-stack {
        width: 100%;
      }
    }

    #colorPicker {
      padding: 0;
      width: 40px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid #ccc;
      cursor: pointer;
    }

    .helper-note {
      font-size: 12px;
      color: var(--muted);
    }

    .panel-tools #toolbar2,
    .panel-colors #toolbar {
      flex-direction: column;
      align-items: stretch;
    }

    .panel-colors .tool-btn {
      justify-content: center;
    }

    @media (max-width: 980px) {
      .workspace {
        grid-template-columns: 1fr;
        grid-template-areas:
          "pages"
          "canvas"
          "tools"
          "colors";
      }

      .panel-tools #toolbar2,
      .panel-colors #toolbar {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="hero">
      <div>
        <span class="badge">ğŸ¨ Creative play</span>
        <h1>Coloring Studio</h1>
        <p>Pick a category, choose a page, and start coloring with pro-level tools.</p>
      </div>
      <div class="helper-note">Tip: Try line tools and fill to speed up shading!</div>
    </header>

    <div class="workspace">
      <section class="panel panel-pages">
        <div class="section-title">
          <h2>Pick a Coloring Page</h2>
          <span>Browse by category to find your next adventure.</span>
        </div>
        <div id="categories">
          <button class="category-btn active" data-category="all">âœ¨ All</button>
          <button class="category-btn" data-category="animals">ğŸ¾ Animals</button>
          <button class="category-btn" data-category="vehicles">ğŸš— Vehicles</button>
          <button class="category-btn" data-category="shapes">ğŸ”· Shapes</button>
          <button class="category-btn" data-category="scenes">ğŸŒˆ Scenes</button>
          <button class="category-btn" data-category="teens">ğŸ§‘â€ğŸ¤ Teens</button>
          <button class="category-btn" data-category="blank">ğŸ“ Blank</button>
        </div>
        <div id="pages" class="page-grid">
          <button class="page-btn active" data-page="catEasy" data-category="animals">ğŸ± Cat (Easy)</button>
          <button class="page-btn" data-page="dinoHard" data-category="animals">ğŸ¦• Dino (Hard)</button>
          <button class="page-btn" data-page="car" data-category="vehicles">ğŸš— Car</button>
          <button class="page-btn" data-page="rocket" data-category="vehicles">ğŸš€ Rocket</button>
          <button class="page-btn" data-page="shapesEasy" data-category="shapes">ğŸ”µ Shapes (Easy)</button>
          <button class="page-btn" data-page="shapesHard" data-category="shapes">ğŸ§© Shapes (Challenge)</button>
          <button class="page-btn" data-page="houseScene" data-category="scenes">ğŸ¡ House Scene</button>
          <button class="page-btn" data-page="rainbowScene" data-category="scenes">ğŸŒˆ Rainbow Scene</button>
          <button class="page-btn" data-page="mandalaVibes" data-category="teens">ğŸŒ€ Mandala Vibes</button>
          <button class="page-btn" data-page="cityNight" data-category="teens">ğŸŒƒ City Night</button>
          <button class="page-btn" data-page="headphones" data-category="teens">ğŸ§ Headphones</button>
          <button class="page-btn" data-page="skateboard" data-category="teens">ğŸ›¹ Skateboard</button>
          <button class="page-btn" data-page="blank" data-category="blank">ğŸ“ Blank</button>
        </div>
      </section>

      <section class="panel panel-tools">
        <div class="section-title">
          <h2>Tools & Effects</h2>
          <span>Switch between brushes, stickers, and erase mode.</span>
        </div>
        <div id="toolbar2">
          <button class="tool-btn active" id="penTool">âœï¸ Draw</button>
          <button class="tool-btn" id="lineTool">ğŸ“ Line</button>
          <button class="tool-btn" id="shapeTool">ğŸ”º Shapes</button>
          <button class="tool-btn" id="fillTool">ğŸª£ Fill</button>
          <button class="tool-btn" id="eraserTool">ğŸ§½ Eraser</button>

          <button class="size-btn active" data-size="4">S</button>
          <button class="size-btn" data-size="8">M</button>
          <button class="size-btn" data-size="14">L</button>

          <button class="brush-btn active" data-brush="normal">Smooth</button>
          <button class="brush-btn" data-brush="dashed">Dashed</button>
          <button class="brush-btn" data-brush="marker">Marker</button>
          <button class="brush-btn" data-brush="fuzzy">Fuzzy</button>

          <button class="shape-btn active" data-shape="rectangle">â¬›</button>
          <button class="shape-btn" data-shape="circle">âšª</button>
          <button class="shape-btn" data-shape="triangle">ğŸ”º</button>

          <button class="sticker-btn" data-sticker="â­">â­</button>
          <button class="sticker-btn" data-sticker="â¤ï¸">â¤ï¸</button>
          <button class="sticker-btn" data-sticker="ğŸ˜Š">ğŸ˜Š</button>
          <button class="tool-btn" id="stickerTool">ğŸ‰ Stickers</button>

          <button class="tool-btn" id="save">ğŸ’¾ Save</button>
          <button class="tool-btn" id="clear">ğŸ§¼ Clear</button>
        </div>
      </section>

      <div class="canvas-area">
        <div id="canvas-wrapper">
          <div id="canvas-stack">
            <canvas id="outlineCanvas" width="900" height="580"></canvas>
            <canvas id="drawCanvas" width="900" height="580"></canvas>
          </div>
        </div>
      </div>

      <section class="panel panel-colors">
        <div class="section-title">
          <h2>Color Palette</h2>
          <span>Tap a swatch or use the picker for custom shades.</span>
        </div>
        <div id="toolbar">
          <div class="color-btn active" style="background:#000000" data-color="#000000"></div>
          <div class="color-btn" style="background:#ff4b4b" data-color="#ff4b4b"></div>
          <div class="color-btn" style="background:#ff9a2f" data-color="#ff9a2f"></div>
          <div class="color-btn" style="background:#ffd93b" data-color="#ffd93b"></div>
          <div class="color-btn" style="background:#4caf50" data-color="#4caf50"></div>
          <div class="color-btn" style="background:#2196f3" data-color="#2196f3"></div>
          <div class="color-btn" style="background:#9c27b0" data-color="#9c27b0"></div>
          <div class="color-btn" style="background:#ff6ec7" data-color="#ff6ec7"></div>
          <div class="color-btn" style="background:#8d6e63" data-color="#8d6e63"></div>
          <label class="tool-btn">
            ğŸ¨
            <input type="color" id="colorPicker" value="#000000" />
          </label>
        </div>
      </section>
    </div>
  </div>

  <script>
    const outlineCanvas = document.getElementById("outlineCanvas");
    const drawCanvas = document.getElementById("drawCanvas");
    const outlineCtx = outlineCanvas.getContext("2d");
    const drawCtx = drawCanvas.getContext("2d");

    let drawing = false;
    let currentColor = "#000000";
    let brushSize = 8;
    let currentTool = "draw"; // draw, line, shape, fill, eraser, sticker
    let currentSticker = "â­";
    let currentBrush = "normal";
    let currentPage = "catEasy";
    let currentShape = "rectangle";
    let shapeStart = null;
    let drawingSnapshot = null;

    // --- Helpers: coordinates ---
    function getPos(e) {
      const rect = drawCanvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: (e.touches[0].clientX - rect.left) * (drawCanvas.width / rect.width),
          y: (e.touches[0].clientY - rect.top) * (drawCanvas.height / rect.height)
        };
      } else {
        return {
          x: (e.clientX - rect.left) * (drawCanvas.width / rect.width),
          y: (e.clientY - rect.top) * (drawCanvas.height / rect.height)
        };
      }
    }

    const baseCanvasWidth = 700;
    const baseCanvasHeight = 450;

    // --- Draw page outlines on OUTLINE canvas only ---
    function drawOutline(page) {
      const scaleX = outlineCanvas.width / baseCanvasWidth;
      const scaleY = outlineCanvas.height / baseCanvasHeight;

      outlineCtx.save();
      outlineCtx.setTransform(1, 0, 0, 1, 0, 0);
      outlineCtx.clearRect(0, 0, outlineCanvas.width, outlineCanvas.height);
      outlineCtx.setTransform(scaleX, 0, 0, scaleY, 0, 0);
      // white background
      outlineCtx.fillStyle = "white";
      outlineCtx.fillRect(0, 0, baseCanvasWidth, baseCanvasHeight);

      outlineCtx.strokeStyle = "#bbbbbb";
      outlineCtx.lineWidth = 3;
      outlineCtx.lineCap = "round";
      outlineCtx.lineJoin = "round";
      outlineCtx.beginPath();

      if (page === "catEasy") {
        // simple cat
        outlineCtx.arc(350, 230, 100, 0, Math.PI * 2);
        // ears
        outlineCtx.moveTo(290, 170);
        outlineCtx.lineTo(270, 130);
        outlineCtx.lineTo(310, 150);
        outlineCtx.moveTo(410, 170);
        outlineCtx.lineTo(430, 130);
        outlineCtx.lineTo(390, 150);
        // eyes
        outlineCtx.moveTo(320, 220);
        outlineCtx.arc(310, 220, 10, 0, Math.PI * 2);
        outlineCtx.moveTo(390, 220);
        outlineCtx.arc(380, 220, 10, 0, Math.PI * 2);
        // nose + mouth
        outlineCtx.moveTo(345, 240);
        outlineCtx.lineTo(355, 240);
        outlineCtx.lineTo(350, 250);
        outlineCtx.moveTo(350, 250);
        outlineCtx.quadraticCurveTo(335, 265, 320, 270);
        outlineCtx.moveTo(350, 250);
        outlineCtx.quadraticCurveTo(365, 265, 380, 270);
      } else if (page === "dinoHard") {
        // dinosaur body
        outlineCtx.moveTo(150, 300);
        outlineCtx.quadraticCurveTo(220, 180, 350, 170);
        outlineCtx.quadraticCurveTo(500, 180, 560, 300);
        outlineCtx.lineTo(150, 300);
        // tail
        outlineCtx.moveTo(150, 300);
        outlineCtx.lineTo(90, 260);
        outlineCtx.lineTo(150, 260);
        // head
        outlineCtx.moveTo(350, 170);
        outlineCtx.lineTo(350, 120);
        outlineCtx.lineTo(400, 120);
        outlineCtx.lineTo(410, 150);
        outlineCtx.lineTo(380, 170);
        // leg 1
        outlineCtx.moveTo(260, 300);
        outlineCtx.lineTo(260, 340);
        outlineCtx.lineTo(290, 340);
        outlineCtx.lineTo(290, 300);
        // leg 2
        outlineCtx.moveTo(430, 300);
        outlineCtx.lineTo(430, 340);
        outlineCtx.lineTo(460, 340);
        outlineCtx.lineTo(460, 300);
        // eye
        outlineCtx.moveTo(365, 140);
        outlineCtx.arc(360, 140, 6, 0, Math.PI * 2);
        // plates
        outlineCtx.moveTo(220, 220);
        outlineCtx.lineTo(240, 190);
        outlineCtx.lineTo(260, 220);
        outlineCtx.moveTo(280, 205);
        outlineCtx.lineTo(300, 175);
        outlineCtx.lineTo(320, 205);
        outlineCtx.moveTo(340, 205);
        outlineCtx.lineTo(360, 175);
        outlineCtx.lineTo(380, 205);
      } else if (page === "car") {
        outlineCtx.moveTo(150, 280);
        outlineCtx.lineTo(550, 280);
        outlineCtx.lineTo(580, 250);
        outlineCtx.lineTo(520, 220);
        outlineCtx.lineTo(400, 220);
        outlineCtx.lineTo(360, 180);
        outlineCtx.lineTo(250, 180);
        outlineCtx.lineTo(220, 220);
        outlineCtx.lineTo(150, 230);
        outlineCtx.closePath();
        // wheels
        outlineCtx.moveTo(230, 280);
        outlineCtx.arc(230, 280, 40, 0, Math.PI * 2);
        outlineCtx.moveTo(470, 280);
        outlineCtx.arc(470, 280, 40, 0, Math.PI * 2);
        // window
        outlineCtx.moveTo(280, 220);
        outlineCtx.lineTo(350, 190);
        outlineCtx.lineTo(390, 190);
        outlineCtx.lineTo(390, 220);
        outlineCtx.closePath();
      } else if (page === "rocket") {
        // rocket body
        outlineCtx.moveTo(350, 100);
        outlineCtx.lineTo(420, 230);
        outlineCtx.lineTo(280, 230);
        outlineCtx.closePath();
        // window
        outlineCtx.moveTo(350, 170);
        outlineCtx.arc(350, 170, 20, 0, Math.PI * 2);
        // fins
        outlineCtx.moveTo(280, 230);
        outlineCtx.lineTo(240, 280);
        outlineCtx.lineTo(280, 260);
        outlineCtx.moveTo(420, 230);
        outlineCtx.lineTo(460, 280);
        outlineCtx.lineTo(420, 260);
        // flames
        outlineCtx.moveTo(280, 230);
        outlineCtx.quadraticCurveTo(350, 330, 420, 230);
      } else if (page === "shapesEasy") {
        // circle
        outlineCtx.arc(200, 170, 60, 0, Math.PI * 2);
        // square
        outlineCtx.rect(320, 110, 120, 120);
        // triangle
        outlineCtx.moveTo(520, 230);
        outlineCtx.lineTo(460, 110);
        outlineCtx.lineTo(580, 110);
        outlineCtx.closePath();
      } else if (page === "shapesHard") {
        // overlapping shapes
        outlineCtx.arc(200, 200, 70, 0, Math.PI * 2);
        outlineCtx.rect(260, 150, 140, 140);
        outlineCtx.moveTo(420, 260);
        outlineCtx.lineTo(520, 120);
        outlineCtx.lineTo(620, 260);
        outlineCtx.closePath();
        // star
        outlineCtx.moveTo(120, 330);
        outlineCtx.lineTo(140, 370);
        outlineCtx.lineTo(190, 370);
        outlineCtx.lineTo(150, 395);
        outlineCtx.lineTo(170, 435);
        outlineCtx.lineTo(120, 410);
        outlineCtx.lineTo(70, 435);
        outlineCtx.lineTo(90, 395);
        outlineCtx.lineTo(50, 370);
        outlineCtx.lineTo(100, 370);
        outlineCtx.closePath();
      } else if (page === "houseScene") {
        // house box
        outlineCtx.rect(220, 220, 200, 150);
        // roof
        outlineCtx.moveTo(220, 220);
        outlineCtx.lineTo(320, 140);
        outlineCtx.lineTo(420, 220);
        outlineCtx.closePath();
        // door
        outlineCtx.rect(260, 260, 60, 110);
        // windows
        outlineCtx.rect(340, 250, 60, 60);
        outlineCtx.moveTo(370, 250);
        outlineCtx.lineTo(370, 310);
        outlineCtx.moveTo(340, 280);
        outlineCtx.lineTo(400, 280);
        // ground
        outlineCtx.moveTo(80, 370);
        outlineCtx.lineTo(620, 370);
        // tree
        outlineCtx.rect(470, 260, 30, 80);
        outlineCtx.moveTo(485, 260);
        outlineCtx.arc(485, 230, 50, 0, Math.PI * 2);
      } else if (page === "rainbowScene") {
        // rainbow arcs
        outlineCtx.moveTo(100, 350);
        outlineCtx.arc(350, 350, 200, Math.PI, 2 * Math.PI);
        outlineCtx.moveTo(130, 350);
        outlineCtx.arc(350, 350, 170, Math.PI, 2 * Math.PI);
        outlineCtx.moveTo(160, 350);
        outlineCtx.arc(350, 350, 140, Math.PI, 2 * Math.PI);
        outlineCtx.moveTo(190, 350);
        outlineCtx.arc(350, 350, 110, Math.PI, 2 * Math.PI);
        // clouds
        outlineCtx.moveTo(120, 350);
        outlineCtx.arc(110, 350, 25, Math.PI, 0);
        outlineCtx.arc(140, 350, 25, Math.PI, 0);
        outlineCtx.arc(170, 350, 25, Math.PI, 0);
        outlineCtx.moveTo(530, 350);
        outlineCtx.arc(520, 350, 25, Math.PI, 0);
        outlineCtx.arc(550, 350, 25, Math.PI, 0);
        outlineCtx.arc(580, 350, 25, Math.PI, 0);
        // sun
        outlineCtx.moveTo(500, 100);
        outlineCtx.arc(500, 100, 40, 0, Math.PI * 2);
      } else if (page === "mandalaVibes") {
        // mandala rings
        outlineCtx.arc(350, 225, 140, 0, Math.PI * 2);
        outlineCtx.moveTo(350, 225);
        outlineCtx.arc(350, 225, 110, 0, Math.PI * 2);
        outlineCtx.moveTo(350, 225);
        outlineCtx.arc(350, 225, 80, 0, Math.PI * 2);
        outlineCtx.moveTo(350, 225);
        outlineCtx.arc(350, 225, 50, 0, Math.PI * 2);
        // petals
        for (let i = 0; i < 12; i++) {
          const angle = (Math.PI * 2 * i) / 12;
          const x = 350 + Math.cos(angle) * 140;
          const y = 225 + Math.sin(angle) * 140;
          outlineCtx.moveTo(350, 225);
          outlineCtx.lineTo(x, y);
          outlineCtx.moveTo(x, y);
          outlineCtx.arc(x, y, 18, 0, Math.PI * 2);
        }
      } else if (page === "cityNight") {
        // skyline
        outlineCtx.rect(80, 180, 90, 190);
        outlineCtx.rect(190, 140, 80, 230);
        outlineCtx.rect(290, 200, 110, 170);
        outlineCtx.rect(420, 120, 100, 250);
        outlineCtx.rect(540, 220, 80, 150);
        // windows
        for (let x = 100; x <= 150; x += 25) {
          for (let y = 200; y <= 330; y += 40) {
            outlineCtx.rect(x, y, 18, 18);
          }
        }
        for (let x = 210; x <= 250; x += 30) {
          for (let y = 160; y <= 330; y += 45) {
            outlineCtx.rect(x, y, 16, 20);
          }
        }
        // moon + stars
        outlineCtx.moveTo(560, 90);
        outlineCtx.arc(540, 90, 30, 0, Math.PI * 2);
        outlineCtx.moveTo(140, 90);
        outlineCtx.arc(140, 90, 6, 0, Math.PI * 2);
        outlineCtx.moveTo(240, 70);
        outlineCtx.arc(240, 70, 5, 0, Math.PI * 2);
        outlineCtx.moveTo(320, 90);
        outlineCtx.arc(320, 90, 4, 0, Math.PI * 2);
        outlineCtx.moveTo(420, 70);
        outlineCtx.arc(420, 70, 5, 0, Math.PI * 2);
      } else if (page === "headphones") {
        // headband
        outlineCtx.moveTo(200, 220);
        outlineCtx.arc(350, 220, 150, Math.PI, 2 * Math.PI);
        outlineCtx.moveTo(240, 220);
        outlineCtx.arc(350, 220, 110, Math.PI, 2 * Math.PI);
        // ear pads
        outlineCtx.roundRect(190, 210, 60, 140, 20);
        outlineCtx.roundRect(450, 210, 60, 140, 20);
        // speaker detail
        outlineCtx.moveTo(220, 250);
        outlineCtx.arc(220, 280, 18, 0, Math.PI * 2);
        outlineCtx.moveTo(480, 250);
        outlineCtx.arc(480, 280, 18, 0, Math.PI * 2);
        // cord
        outlineCtx.moveTo(350, 360);
        outlineCtx.quadraticCurveTo(370, 400, 400, 420);
      } else if (page === "skateboard") {
        outlineCtx.roundRect(160, 210, 380, 80, 40);
        outlineCtx.moveTo(220, 290);
        outlineCtx.arc(220, 310, 30, 0, Math.PI * 2);
        outlineCtx.moveTo(480, 290);
        outlineCtx.arc(480, 310, 30, 0, Math.PI * 2);
        outlineCtx.moveTo(220, 310);
        outlineCtx.arc(220, 310, 12, 0, Math.PI * 2);
        outlineCtx.moveTo(480, 310);
        outlineCtx.arc(480, 310, 12, 0, Math.PI * 2);
        outlineCtx.moveTo(250, 250);
        outlineCtx.lineTo(450, 250);
      } else if (page === "blank") {
        // no outline, just white background already filled
      }

      outlineCtx.stroke();
      outlineCtx.restore();

      // important: clear childrenâ€™s drawing layer when page changes
      clearDrawingLayer();
    }

    function clearDrawingLayer() {
      drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
    }

    // --- Drawing & stickers on DRAW canvas only ---
    function startDraw(e) {
      e.preventDefault();
      const pos = getPos(e);

      if (currentTool === "sticker") {
        drawCtx.save();
        drawCtx.font = "48px Arial";
        drawCtx.textAlign = "center";
        drawCtx.textBaseline = "middle";
        drawCtx.fillText(currentSticker, pos.x, pos.y);
        drawCtx.restore();
        return;
      }

      if (currentTool === "fill") {
        floodFill(Math.floor(pos.x), Math.floor(pos.y), currentColor);
        return;
      }

      drawing = true;
      shapeStart = pos;
      drawingSnapshot =
        currentTool === "line" || currentTool === "shape"
          ? drawCtx.getImageData(0, 0, drawCanvas.width, drawCanvas.height)
          : null;
      setupBrush();
      drawCtx.beginPath();
      drawCtx.moveTo(pos.x, pos.y);
      draw(e);
    }

    function setupBrush() {
      drawCtx.setLineDash([]);
      drawCtx.globalAlpha = 1.0;
      drawCtx.lineCap = "round";
      drawCtx.lineJoin = "round";

      if (currentTool === "eraser") {
        drawCtx.strokeStyle = "#ffffff"; // ONLY erases drawing layer
        drawCtx.lineWidth = brushSize * 1.4;
        return;
      }

      // drawing
      drawCtx.strokeStyle = currentColor;
      drawCtx.lineWidth = brushSize;

      if (currentBrush === "dashed") {
        drawCtx.setLineDash([brushSize * 1.5, brushSize * 1.2]);
      } else if (currentBrush === "marker") {
        drawCtx.globalAlpha = 0.6;
        drawCtx.lineWidth = brushSize * 1.3;
      } else if (currentBrush === "fuzzy") {
        // main stroke normal, fuzzy effect handled in draw()
      }
    }

    function renderShape(pos, finalize = false) {
      if (!shapeStart) return;
      setupBrush();
      drawCtx.beginPath();

      if (currentTool === "line") {
        drawCtx.moveTo(shapeStart.x, shapeStart.y);
        drawCtx.lineTo(pos.x, pos.y);
      } else if (currentShape === "rectangle") {
        const width = pos.x - shapeStart.x;
        const height = pos.y - shapeStart.y;
        drawCtx.rect(shapeStart.x, shapeStart.y, width, height);
      } else if (currentShape === "circle") {
        const radius = Math.hypot(pos.x - shapeStart.x, pos.y - shapeStart.y);
        drawCtx.arc(shapeStart.x, shapeStart.y, radius, 0, Math.PI * 2);
      } else if (currentShape === "triangle") {
        const midpointX = (shapeStart.x + pos.x) / 2;
        drawCtx.moveTo(midpointX, shapeStart.y);
        drawCtx.lineTo(pos.x, pos.y);
        drawCtx.lineTo(shapeStart.x, pos.y);
        drawCtx.closePath();
      }

      drawCtx.stroke();
      if (finalize) {
        drawCtx.closePath();
      }
    }

    function hexToRgb(hex) {
      const normalized = hex.replace("#", "");
      const bigint = parseInt(normalized.length === 3
        ? normalized.split("").map((c) => c + c).join("")
        : normalized, 16);
      return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
      };
    }

    function colorsMatch(data, index, target, tolerance = 16) {
      return (
        Math.abs(data[index] - target.r) <= tolerance &&
        Math.abs(data[index + 1] - target.g) <= tolerance &&
        Math.abs(data[index + 2] - target.b) <= tolerance
      );
    }

    function floodFill(startX, startY, hexColor) {
      const width = drawCanvas.width;
      const height = drawCanvas.height;

      const tempCanvas = document.createElement("canvas");
      tempCanvas.width = width;
      tempCanvas.height = height;
      const tempCtx = tempCanvas.getContext("2d");
      tempCtx.drawImage(outlineCanvas, 0, 0);
      tempCtx.drawImage(drawCanvas, 0, 0);

      const merged = tempCtx.getImageData(0, 0, width, height);
      const drawData = drawCtx.getImageData(0, 0, width, height);
      const fill = hexToRgb(hexColor);

      const startIndex = (startY * width + startX) * 4;
      const target = {
        r: merged.data[startIndex],
        g: merged.data[startIndex + 1],
        b: merged.data[startIndex + 2],
      };

      if (colorsMatch(merged.data, startIndex, fill)) {
        return;
      }

      const stack = [{ x: startX, y: startY }];
      const tolerance = 18;

      while (stack.length) {
        const { x, y } = stack.pop();
        if (x < 0 || y < 0 || x >= width || y >= height) {
          continue;
        }
        const idx = (y * width + x) * 4;
        if (!colorsMatch(merged.data, idx, target, tolerance)) {
          continue;
        }

        merged.data[idx] = fill.r;
        merged.data[idx + 1] = fill.g;
        merged.data[idx + 2] = fill.b;
        merged.data[idx + 3] = 255;

        drawData.data[idx] = fill.r;
        drawData.data[idx + 1] = fill.g;
        drawData.data[idx + 2] = fill.b;
        drawData.data[idx + 3] = 255;

        stack.push({ x: x + 1, y });
        stack.push({ x: x - 1, y });
        stack.push({ x, y: y + 1 });
        stack.push({ x, y: y - 1 });
      }

      drawCtx.putImageData(drawData, 0, 0);
    }

    function draw(e) {
      e.preventDefault();
      if (!drawing) return;

      const pos = getPos(e);

      if (currentTool === "line" || currentTool === "shape") {
        if (drawingSnapshot) {
          drawCtx.putImageData(drawingSnapshot, 0, 0);
          renderShape(pos);
        }
        return;
      }

      if (currentBrush === "fuzzy" && currentTool !== "eraser") {
        // fuzzy effect: main line + two light offset lines
        drawCtx.save();
        drawCtx.setLineDash([]);
        drawCtx.globalAlpha = 1.0;
        drawCtx.lineWidth = brushSize;
        drawCtx.strokeStyle = currentColor;
        drawCtx.lineTo(pos.x, pos.y);
        drawCtx.stroke();
        drawCtx.beginPath();
        drawCtx.moveTo(pos.x, pos.y);

        drawCtx.globalAlpha = 0.3;
        drawCtx.lineWidth = brushSize * 0.7;
        drawCtx.lineTo(pos.x + 2, pos.y + 2);
        drawCtx.stroke();
        drawCtx.beginPath();
        drawCtx.moveTo(pos.x + 2, pos.y + 2);

        drawCtx.lineTo(pos.x - 2, pos.y - 2);
        drawCtx.stroke();
        drawCtx.beginPath();
        drawCtx.moveTo(pos.x - 2, pos.y - 2);
        drawCtx.restore();
      } else {
        // normal / dashed / marker / eraser
        drawCtx.lineTo(pos.x, pos.y);
        drawCtx.stroke();
        drawCtx.beginPath();
        drawCtx.moveTo(pos.x, pos.y);
      }
    }

    function endDraw(e) {
      if (e) e.preventDefault();
      if (drawing && (currentTool === "line" || currentTool === "shape")) {
        const pos = getPos(e);
        drawCtx.putImageData(drawingSnapshot, 0, 0);
        renderShape(pos, true);
      }
      drawing = false;
      shapeStart = null;
      drawingSnapshot = null;
      drawCtx.beginPath();
    }

    // --- Init first page ---
    drawOutline(currentPage);

    // --- Colours ---
    const colorBtns = document.querySelectorAll(".color-btn");
    colorBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        currentColor = btn.dataset.color;
        if (currentTool === "eraser") {
          setActiveTool("draw");
        }
        colorBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("colorPicker").value = currentColor;
      });
    });

    const colorPicker = document.getElementById("colorPicker");
    colorPicker.addEventListener("input", (e) => {
      currentColor = e.target.value;
      if (currentTool === "eraser") {
        setActiveTool("draw");
      }
      colorBtns.forEach(b => b.classList.remove("active"));
    });

    // --- Brush sizes ---
    const sizeBtns = document.querySelectorAll(".size-btn");
    sizeBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        brushSize = parseInt(btn.dataset.size, 10);
        sizeBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    // --- Brush types ---
    const brushBtns = document.querySelectorAll(".brush-btn");
    const shapeBtns = document.querySelectorAll(".shape-btn");
    brushBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        currentBrush = btn.dataset.brush;
        brushBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    shapeBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        currentShape = btn.dataset.shape;
        shapeBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        setActiveTool("shape");
      });
    });

    // --- Tools ---
    const penTool = document.getElementById("penTool");
    const lineTool = document.getElementById("lineTool");
    const shapeTool = document.getElementById("shapeTool");
    const fillTool = document.getElementById("fillTool");
    const eraserTool = document.getElementById("eraserTool");
    const stickerTool = document.getElementById("stickerTool");
    const stickerBtns = document.querySelectorAll(".sticker-btn");

    const toolButtons = [penTool, lineTool, shapeTool, fillTool, eraserTool, stickerTool];

    function setActiveTool(tool) {
      currentTool = tool;
      toolButtons.forEach((btn) => btn.classList.remove("active"));
      if (tool === "draw") {
        penTool.classList.add("active");
      } else if (tool === "line") {
        lineTool.classList.add("active");
      } else if (tool === "shape") {
        shapeTool.classList.add("active");
      } else if (tool === "fill") {
        fillTool.classList.add("active");
      } else if (tool === "eraser") {
        eraserTool.classList.add("active");
      } else if (tool === "sticker") {
        stickerTool.classList.add("active");
      }
    }

    penTool.addEventListener("click", () => {
      setActiveTool("draw");
    });

    lineTool.addEventListener("click", () => {
      setActiveTool("line");
    });

    shapeTool.addEventListener("click", () => {
      setActiveTool("shape");
    });

    fillTool.addEventListener("click", () => {
      setActiveTool("fill");
    });

    eraserTool.addEventListener("click", () => {
      setActiveTool("eraser");
    });

    stickerTool.addEventListener("click", () => {
      setActiveTool("sticker");
    });

    stickerBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        currentSticker = btn.dataset.sticker;
        setActiveTool("sticker");
        stickerBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    // --- Pages ---
    const pageBtns = document.querySelectorAll(".page-btn");
    pageBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        currentPage = btn.dataset.page;
        pageBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        drawOutline(currentPage);
      });
    });

    // --- Categories ---
    const categoryBtns = document.querySelectorAll(".category-btn");

    function updateCategory(category) {
      categoryBtns.forEach(btn => btn.classList.remove("active"));
      document.querySelector(`.category-btn[data-category="${category}"]`).classList.add("active");

      let firstVisible = null;

      pageBtns.forEach(btn => {
        const matches = category === "all" || btn.dataset.category === category;
        btn.style.display = matches ? "inline-flex" : "none";
        if (matches && !firstVisible) {
          firstVisible = btn;
        }
      });

      if (firstVisible && !firstVisible.classList.contains("active")) {
        pageBtns.forEach(b => b.classList.remove("active"));
        firstVisible.classList.add("active");
        currentPage = firstVisible.dataset.page;
        drawOutline(currentPage);
      }
    }

    categoryBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        updateCategory(btn.dataset.category);
      });
    });

    // --- Clear (only drawing layer) ---
    document.getElementById("clear").addEventListener("click", () => {
      clearDrawingLayer();
    });

    // --- Save: merge OUTLINE + DRAW into one image ---
    document.getElementById("save").addEventListener("click", () => {
      const tempCanvas = document.createElement("canvas");
      tempCanvas.width = outlineCanvas.width;
      tempCanvas.height = outlineCanvas.height;
      const tempCtx = tempCanvas.getContext("2d");

      tempCtx.drawImage(outlineCanvas, 0, 0);
      tempCtx.drawImage(drawCanvas, 0, 0);

      const link = document.createElement("a");
      link.href = tempCanvas.toDataURL("image/png");
      link.download = "my-coloring.png";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // --- Events (mouse + touch) ---
    drawCanvas.addEventListener("mousedown", startDraw);
    drawCanvas.addEventListener("mousemove", draw);
    drawCanvas.addEventListener("mouseup", endDraw);
    drawCanvas.addEventListener("mouseleave", endDraw);

    drawCanvas.addEventListener("touchstart", startDraw, { passive:false });
    drawCanvas.addEventListener("touchmove", draw, { passive:false });
    drawCanvas.addEventListener("touchend", endDraw, { passive:false });
  </script>

</body>
</html>
